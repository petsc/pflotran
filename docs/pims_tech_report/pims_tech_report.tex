\documentclass[12pt]{article} 
\usepackage{times}
\usepackage{amsmath,amsbsy,amssymb}
\usepackage{deflist}
%\usepackage{fancyheadings}
\usepackage{fancyhdr}
\usepackage{tabularx}
\usepackage{verbatim}
\usepackage{moreverb}
\usepackage{float}
\usepackage{fancybox}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{subfigure}
%\usepackage{here}
\usepackage{ssss}
\usepackage{booktabs}
%\usepackage{toc_entr}

\usepackage[super,comma,sort]{natbib} 
%\usepackage[linux]{vpe}
%\vpesetup{noref}
%define citation punctuation style
\bibpunct[, ]{(}{)}{;}{a}{,}{,}

\usepackage[debug=false, colorlinks=true, pdfstartview=FitV, linkcolor=blue, citecolor=black, urlcolor=blue]{hyperref}

\textwidth 6in
\textheight 8.75in
\topmargin -0.75in
%\topmargin -3.280cm 
\newlength{\boxwidth}
\setlength{\boxwidth}{5.8in}
\oddsidemargin 0.25in
\evensidemargin 0.25in
\headheight 0.25in
\lhead{Lichtner \& Lu: {\sl PIMS Tech. Report}}
\chead{} 
%\chead{\rm - \thepage\ -} 
\rhead{DRAFT \qquad \qquad \ \today} 
%\rfoot{\today--[\thepage]}
\rfoot{}
\cfoot{\rm - \thepage\ -}
%\cfoot{}
%\footrulewidth 0.4pt
\newcommand{\negsp}{\vspace{-4mm}} 
\newcommand\secsp{\vspace{-3 mm}}
\newcommand\secspb{\vspace{-2 mm}}
\newcommand\subsecsp{\vspace{-0.0 mm}}
\newcommand\multiflo{{\bf\sl MULTIFLO}}
\newcommand\metra{{\bf\sl METRA}}
\newcommand\gem{{\bf\sl GEM}}
\renewcommand{\baselinestretch}{1.5} 
%\setlength{\baselineskip}{13pt}
\def\EQ#1\EN{\begin{equation}#1\end{equation}}
\def\BA#1\EA{\begin{align}#1\end{align}}
\def\BS#1\ES{\begin{split}#1\end{split}}
%\newcommand{\EQ}{\begin{equation}} 
%\newcommand{\EN}{\end{equation}} 
\newcommand{\longline}{\noindent\rule[-0.1in]{\textwidth}{0.01in}}
\newcommand{\bc}{\begin{center}} 
\newcommand{\ec}{\end{center}} 
\newcommand{\degc}{$^\circ$C} 
\newcommand{\eq}{\ =\ } 
\newcommand{\eff}{{\rm eff}}
\newcommand{\eqr}{{\rm le}}
\newcommand{\equ}{{\rm eq}} 
\newcommand{\kin}{{\rm kin}} 
\newcommand{\rdx}{{\rm rdx}} 
\newcommand{\ind}{{\rm id}} 
\newcommand{\dep}{{\rm dp}}
\newcommand{\e}{{\rm{e}}} 
\newcommand{\erf}{{\rm{erf}}} 
\newcommand{\erfc}{{\rm{erfc}}} 
\renewcommand{\sc}{{\rm sc}}
\newcommand{\sign}{{\rm{sign}}} 
\newcommand{\p}{{\partial}}
\newcommand{\A}{{\mathcal A}}
\newcommand{\B}{{\mathcal B}}
\newcommand{\C}{{\mathcal C}}
\newcommand{\D}{{\mathcal D}}
\newcommand{\E}{{\mathcal E}}
\newcommand{\F}{{\mathcal F}}
\newcommand{\G}{{\mathcal G}}
\newcommand{\J}{{\mathcal J}}
\newcommand{\jo}{{j_o}}
\newcommand{\M}{{\mathcal M}}
\newcommand{\mO}{{\mathcal O}}
\renewcommand{\P}{{{\mathcal P}}}
\newcommand{\Q}{{\mathcal Q}}
\newcommand{\R}{{{\mathcal R}}}
\renewcommand{\S}{{\mathcal S}}
\newcommand{\T}{{\mathcal T}}
\newcommand{\W}{{\mathcal W}}
\newcommand{\X}{{\mathcal X}}
\newcommand{\Y}{{\mathcal Y}}
\newcommand{\Z}{{\mathcal Z}}
\newcommand{\rev}{{\rm rev}}
\newcommand{\irr}{{\rm irr}}
\renewcommand{\a}{{\alpha}} 
\newcommand{\abar}{{\bar \alpha}} 
\renewcommand{\b}{{\beta}} 
\renewcommand{\c}{{\rm CO_2}}
\newcommand{\w}{{\rm H_2O}}
\newcommand{\air}{{\rm N_2}}
\newcommand{\pe}{{\rm Pe}}
\newcommand{\da}{{\rm Da}}
\renewcommand{\k}{{\dot R}^0}
\renewcommand{\L}{\widehat{\mathcal L}}
\renewcommand{\bar}{\overline}
\newcommand{\dsty}{{\displaystyle}}
\newcommand{\diff}{{\mathcal D}} 
\newcommand{\surf}{\equiv \!\!\!}
\newcommand{\bnabla}{\boldsymbol{\nabla}}
\newcommand{\bA}{\boldsymbol{A}}
\newcommand{\ba}{\boldsymbol{a}}
\newcommand{\bB}{\boldsymbol{B}}
\newcommand{\bC}{\boldsymbol{C}}
\newcommand{\bE}{\boldsymbol{E}}
\newcommand{\bF}{\boldsymbol{F}}
\newcommand{\bi}{\boldsymbol{i}}
\newcommand{\bI}{\boldsymbol{I}}
\newcommand{\bJ}{\boldsymbol{J}}
\newcommand{\bK}{\boldsymbol{K}}
\newcommand{\bM}{\boldsymbol{M}}
\newcommand{\bg}{\boldsymbol{g}}
\newcommand{\bGamma}{\boldsymbol{\Gamma}}
\newcommand{\bOmega}{\boldsymbol{\Omega}}
\newcommand{\bPsi}{\boldsymbol{\Psi}}
\newcommand{\bO}{\boldsymbol{O}}
\newcommand{\bnu}{\boldsymbol{\nu}}
\newcommand{\bdS}{\boldsymbol{dS}}
\newcommand{\bq}{\boldsymbol{q}}
\newcommand{\br}{\boldsymbol{r}}
\newcommand{\bR}{\boldsymbol{R}}
\newcommand{\bS}{\boldsymbol{S}}
\newcommand{\bu}{\boldsymbol{u}}
\newcommand{\bv}{\boldsymbol{v}}
\newcommand{\bz}{\boldsymbol{z}}
\newcommand{\arrows}{~\rightleftharpoons~} 
\newcommand{\arrowstab}{\!\!\!\rightleftharpoons\!\!\!} 
\newcommand{\CA}{C_{\rm A}}
\newcommand{\CB}{C_{\rm B}}
\newcommand{\CC}{C_{\rm C}}
\newcommand{\CAB}{C_{\rm AB}}
\newcommand{\CBC}{C_{\rm BC}}
\newcommand{\RA}{\R_{\rm A}}
\newcommand{\RB}{\R_{\rm B}}
\newcommand{\RC}{\R_{\rm C}}
\newcommand{\RAB}{\R_{\rm AB}}
\newcommand{\RBC}{\R_{\rm BC}}
%\newcommand{\kdsc}{K^{DS}}
%\newcommand{\kdec}{K^{DE}}
%\newcommand{\kdsm}{\overline K^{DS}}
%\newcommand{\kdem}{\overline K^{DE}}
\newcommand{\kdsc}{K^{sc}}
\newcommand{\kdec}{K^{ec}}
\newcommand{\kdsm}{K^{sm}}
\newcommand{\kdem}{K^{em}}
\newcommand{\csm}{S}
\renewcommand{\csc}{S}
\newcommand{\cem}{\E}
\newcommand{\cec}{\E}
\renewcommand{\min}{{\rm min}}
\newcommand{\coll}{{\rm coll}}
\newcommand{\ex}{{\rm ex}}
\newcommand{\srf}{{\rm srf}}
\def\dbar{{\mkern2mu\mathchar'26\mkern-11mu\mathrm{d}}}

\newcounter{saveeqn}%
\newcommand{\alpheqn}{\setcounter{saveeqn}{\value{equation}}%
\stepcounter{saveeqn}\setcounter{equation}{0}%
\renewcommand{\theequation}
      {\mbox{\arabic{saveeqn}\alph{equation}}}}%
\newcommand{\reseteqn}{\setcounter{equation}{\value{saveeqn}}%
\renewcommand{\theequation}{\arabic{equation}}}%

\renewcommand{\contentsname}{TABLE OF CONTENTS}
\renewcommand{\listfigurename}{{LIST OF FIGURES}}
\renewcommand{\listtablename}{{LIST OF TABLES}}

\renewcommand{\arraystretch}{1.0}

\setlength{\parindent}{0.3125in}
\setlength{\parskip}{2ex plus 0.2ex minus 0.2ex}

\setcounter{secnumdepth}{5}
\setcounter{tocdepth}{5}

\pagestyle{fancy}
%\pagestyle{empty}

\thispagestyle{empty}

\renewcommand{\theequation}{\arabic{equation}}
%\renewcommand{\thetable}{{\protect\bf\arabic{table}}}
%\renewcommand{\thefigure}{{\protect\bf\arabic{figure}}}
%\renewcommand{\thepage}{\roman{page}}

\begin{document}
%begin title page


\noindent
{\large\sffamily LA-UR-??-????}

\medskip

\noindent
\scriptsize
{\em Approved for public release;}\\
{\em distribution is unlimited.}

\normalsize

\bc
\begin{tabular}{r|l}
~ & ~\\
{\em Title:} & {\sl PIMS Tech. Report}\\
~ & ~\\
~ & ~\\
~ & ~\\
{\em Author(s):} & Chuan Lu (clu@lanl.gov)\\
~ & Peter C. Lichtner (lichtner@lanl.gov)\\
~ & ~\\
~ & ~\\
{\em Submitted to:} & \\
~ & ~\\
~ & ~\\
~ & ~\\
{\em Date:} & \today \\
~ & ~\\
~ & {\bf \large DRAFT}\\
~ & ~\\
\end{tabular}
\ec

\vfill

\noindent
{\Huge\sffamily Los Alamos}

\vspace{-8pt}

\noindent
{\sffamily NATIONAL LABORATORY}

\vspace{-6pt}

\noindent
\scriptsize
Los Alamos National Laboratory, an affirmative action/equal opportunity employer, is operated by the Los Alamos National Security, LLC, for the National Nuclear Security Administration of the U.S. Department of Energy under contract DE-AC52-06NA25396. By acceptance of this article, the publisher recognizes that the U.S. Government retains a nonexclusive, royalty-free license to publish or reproduce the published form of this contribution, or to allow others to do so, for U.S. Government purposes. Los Alamos National Laboratory requests that the publisher identify this article as work performed under the auspices of the U.S. Department of Energy. Los Alamos National Laboratory strongly supports academic freedom and a researcher's right to publish; as an institution, however, the Laboratory does not endorse the viewpoint of a publication or guarantee its technical correctness.

\normalsize

\clearpage

\tableofcontents
%\clearpage

\listoffigures

\listoftables

\clearpage




\section{Governing equations}
PIMS, parallel immiscible multiphase flow simulator. is a simplified version of PFLOTRAN
by removing the most dependences on thermodynamic calculations, since for immiscible system, the solubility is zero for every component. Then the number of component is the same as the number of phases,  and the degree of freedom on every node if isothermal system is consider. This totally immiscible assumption also remove the variable switching strategy, which may be the most tricky part of PFLOTRAN, and may cause trouble for multi-level solvers. \\
The governing equations solved by PIMS could be read as:

\EQ\label{mass}
\frac{\p}{\p t}\bigg[\varphi (\rho_i s_i)\bigg] + \bnabla\cdot \bigg(\rho_i  \bq_i \bigg) \eq S_i,
\EN
where $\varphi$ is porosity,  $s_i$, $\rho_i$ is $i$ phase saturation and density, $q_i$ is $i$ phase velocity, $S_i$ is the source/sink term. Thus, the number of equations is equal to number of phases. 
The selection of primary variables are pressure $p$ and phase saturations $s_i, i=1,...,n-1$, if incompressibility of all phases or one of them is assumed. In this case, the reference pressure has to be specified as a boundary condition.\\ 
The primary variables also could be $s_i, i=1,...,n$, if suitable EOS are applied to every phases. Then the second type BC could be assigned to all boundaries.
Compared with PFLOTRAN, PIMS conserves mass instead of molar numbers. 

\section{PETSc Solver}
PIMS is using PETSc SNES nonlinear solver. 
Note: the pre-conditioner option "-pc\_factor \_nonzeros\_along\_diagonal" is needed to reduce the chance to get zero pivot. Since for incompressible fluid, if the phase saturation is lower than its residual, the mass balance equation for that phase is independent of pressure and adjacent nodes' saturation. 







\end{document}
